<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="preconnect" href="https://api.patoken.org" crossorigin="use-credentials" />
		<meta name="description" content="パト研のみんなの夢の記録" />
		<meta name="theme-color" id="theme-color" />
		<meta name="color-scheme" id="color-scheme" content="dark light" />
		<script>
			const rootElement = document.documentElement
			const darkModeAttributeName = 'data-user-color-scheme'
			const darkModeStorageKey = 'user-color-scheme'
			const colorSchemeMetaElement = document.getElementById('color-scheme')

			const getMediaQueryMode = () => (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')

			const resetRootDarkModeAttributeAndLS = () => {
				rootElement.removeAttribute(darkModeAttributeName)
				localStorage.removeItem(darkModeStorageKey)
				colorSchemeMetaElement.setAttribute('content', 'dark light')
			}

			const applyDarkModeSettings = () => {
				let currentSetting = localStorage.getItem(darkModeStorageKey)
				const mediaQueryMode = getMediaQueryMode()

				if (currentSetting && currentSetting !== mediaQueryMode) {
					rootElement.setAttribute(darkModeAttributeName, currentSetting)
					colorSchemeMetaElement.setAttribute('content', currentSetting)
				} else {
					resetRootDarkModeAttributeAndLS()
					currentSetting = mediaQueryMode
				}
				document
					.getElementById('theme-color')
					.setAttribute('content', currentSetting === 'dark' ? '#212020' : '#fafafa')
			}

			applyDarkModeSettings()
		</script>
		%svelte.head%
	</head>
	<body>
		<div id="svelte">%svelte.body%</div>
	</body>
</html>
